# ============================================
# Project Valine Environment Variables
# ============================================

# --------------------------------------------
# Frontend Configuration
# --------------------------------------------

# API Base URL - The serverless backend endpoint (API Gateway, NOT CloudFront)
# IMPORTANT: Use API Gateway URL for API calls, not CloudFront distribution URL
# Development: http://localhost:3001 (local serverless offline)
# Staging: https://your-api-id.execute-api.us-west-2.amazonaws.com/dev
# Production: https://your-api-id.execute-api.us-west-2.amazonaws.com/prod
# Example production API Gateway URL: https://i72dxlcfcc.execute-api.us-west-2.amazonaws.com
VITE_API_BASE=http://localhost:3001

# API Path Normalization - Strip legacy /api prefix from request paths
# Set to 'true' to automatically remove '/api' prefix from request paths (e.g., /api/me/preferences → /me/preferences)
# Useful when backend doesn't use /api prefix but frontend code has legacy paths
# Set to 'false' to send paths as-is
# Default: false
VITE_API_STRIP_LEGACY_API_PREFIX=false

# Analytics - Enable analytics tracking and config fetching
# Set to 'true' to enable analytics config fetch and event tracking
# Set to 'false' to disable analytics entirely (recommended for development)
# When false, prevents requests to /analytics/config endpoint
# Default: false
VITE_ANALYTICS_ENABLED=false

# API Integration Mode - Controls whether to use real API or fallback to mocks
# Set to 'true' to enable real API integration with fallback
# Set to 'false' to use only MSW mocks (useful for development without backend)
# Default: false (uses mocks)
VITE_API_INTEGRATION=false

# API Credentials Mode - Controls withCredentials for cookie-based authentication
# DEPRECATED: Use VITE_ENABLE_AUTH instead
# Set to 'true' if your backend uses HTTP-only cookies for auth
# Set to 'false' if using Bearer tokens (default)
# Default: false
VITE_API_USE_CREDENTIALS=false

# Cookie-Based Authentication - Enable Phase C HttpOnly cookie auth
# Set to 'true' to use secure HttpOnly cookies for authentication (recommended for production)
# Set to 'false' to use localStorage tokens (development/legacy mode)
# When true:
#   - Tokens stored in HttpOnly cookies (XSS protection)
#   - Auto token refresh with rotation
#   - CSRF protection via SameSite=Lax
# When false:
#   - Tokens stored in localStorage (backward compatibility)
#   - Manual token management required
# Default: false
VITE_ENABLE_AUTH=false

# CSRF Protection - Enable Cross-Site Request Forgery protection
# Set to 'true' to enable CSRF token validation on state-changing requests
# Requires backend to set XSRF-TOKEN cookie and validate X-CSRF-Token header
# When true:
#   - Reads XSRF-TOKEN cookie set by backend
#   - Sends X-CSRF-Token header on POST/PUT/PATCH/DELETE requests
#   - Handles token rotation automatically
# Default: false (enabled automatically when VITE_ENABLE_AUTH is true)
VITE_CSRF_ENABLED=false

# Session Tracking - Enable session management UI
# Set to 'true' to enable session tracking and management features
# Allows users to view and revoke active sessions from Settings page
# Requires backend USE_SESSION_TRACKING=true
# Default: false
VITE_USE_SESSION_TRACKING=false

# Two-Factor Authentication - Enable 2FA features
# Set to 'true' to enable two-factor authentication UI in Settings
# Allows users to enroll in TOTP-based 2FA for enhanced security
# Requires backend TWO_FACTOR_ENABLED=true
# Default: false
VITE_TWO_FACTOR_ENABLED=false

# MSW Development Mode - Enable Mock Service Worker in browser
# Set to 'true' to enable MSW for development without real backend
# Set to 'false' to disable MSW and use real API
# Default: false
VITE_USE_MSW=false

# Profile Links API - Enable backend integration for profile links
# Set to 'true' to call backend API for profile links and headline updates
# Set to 'false' to use local state only (optimistic updates)
# Default: false (backend integration pending)
VITE_ENABLE_PROFILE_LINKS_API=false

# Registration Control - Show/hide signup UI in frontend
# Set to 'true' to show "Sign Up" button and registration routes
# Set to 'false' to hide signup UI and disable registration routes
# Must match backend ENABLE_REGISTRATION flag
# Default: false (registration hidden in production)
VITE_ENABLE_REGISTRATION=false

# Legal Pages - Enable legal compliance pages (Privacy, Terms, Cookies)
# Set to 'true' to show legal pages in footer and sitemap
# Set to 'false' to hide legal pages (rollback capability)
# Default: true
LEGAL_PAGES_ENABLED=true

# Dev Bypass - LOCALHOST-ONLY authentication bypass for fast UX iteration
# Set to 'true' to enable "Dev Bypass" button on login page (LOCALHOST ONLY)
# Button only appears when BOTH conditions are met:
#   1. window.location.hostname === 'localhost'
#   2. VITE_ENABLE_DEV_BYPASS === 'true'
# Build safeguard: Build will FAIL if this is 'true' AND VITE_FRONTEND_URL contains
# production domains (cloudfront.net or projectvaline.com)
# ⚠️ MUST be 'false' in production - never deploy with this enabled
# Default: false
VITE_ENABLE_DEV_BYPASS=false

# Frontend URL - Used for CORS and dev bypass production domain check
# Development: http://localhost:5173
# Production: https://d1abc.cloudfront.net or https://projectvaline.com
# Default: http://localhost:5173
VITE_FRONTEND_URL=http://localhost:5173

# --------------------------------------------
# Backend Configuration (Serverless/Lambda)
# --------------------------------------------

# Dev Bypass Backend Flag - Future-proofing for backend dev bypass endpoint
# Currently unused - dev bypass is pure frontend for now
# Set to 'true' to enable backend dev bypass endpoints (when implemented)
# Default: false
DEV_BYPASS_ENABLED=false


# Database connection string
# This is used by the serverless backend and should be set in:
# - Local development: .env file or environment variable
# - AWS Lambda: Environment variable in serverless.yml or AWS Systems Manager

# PostgreSQL (recommended for production)
DATABASE_URL=postgresql://username:password@host:5432/valine_db

# PostgreSQL with SSL (recommended for production with RDS)
# DATABASE_URL=postgresql://username:password@host:5432/valine_db?sslmode=require

# MySQL (alternative)
# DATABASE_URL=mysql://username:password@host:3306/valine_db

# SQLite (for local development only - not recommended for production)
# DATABASE_URL=file:./dev.db

# --------------------------------------------
# Account Creation & Authentication (NEW)
# --------------------------------------------

# JWT Secret for authentication tokens
# REQUIRED - Generate a secure random string (256 bits / 32+ characters)
# Example: openssl rand -base64 32
AUTH_JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# JWT Token Expiration (default: 24h)
JWT_EXPIRATION=24h

# Frontend Base URL (for verification emails)
# Used to generate verification links
FRONTEND_BASE_URL=http://localhost:5173

# Email sending (MVP: disabled, tokens logged to console)
# Set to 'true' to enable actual email sending (requires SMTP config)
EMAIL_ENABLED=false

# --------------------------------------------
# Security Hardening (Production)
# --------------------------------------------

# Registration Control - Disable registration in production
# Set to 'true' to allow new user registrations
# Set to 'false' to block registration endpoint (403 response)
# Default: false (registration disabled for production security)
# In development, set to 'true' to allow testing account creation
ENABLE_REGISTRATION=false

# Email Allowlist - Post-authentication access control
# Comma-separated list of email addresses allowed to login and register
# Users not in this list will receive 403 even with valid credentials
# Leave empty to allow all registered users (not recommended for production)
# Example: owner@example.com,friend@example.com
# Production: Set via AWS Lambda environment variables (see docs/runbooks/prod-deploy-and-routing.md)
# Default: empty (no restrictions in development)
ALLOWED_USER_EMAILS=

# CSRF Protection - Cross-Site Request Forgery protection
# Set to 'true' to enable CSRF token validation on state-changing requests
# Requires frontend to send X-CSRF-Token header from XSRF-TOKEN cookie
# Default: false (enable in production for cookie-based auth)
CSRF_ENABLED=false

# Cookie Domain - Scope for authentication cookies
# Leave empty for same-domain cookies (recommended)
# Set to '.yourdomain.com' for subdomain sharing
# Default: empty (same-domain)
COOKIE_DOMAIN=

# Node Environment - Determines cookie security flags
# Set to 'production' to enable Secure flag and SameSite=Strict on cookies
# Set to 'development' for SameSite=Lax (easier local testing)
# Default: development
NODE_ENV=development

# --------------------------------------------
# AWS Configuration (for deployment)
# --------------------------------------------

# AWS Region for deployment
AWS_REGION=us-west-2

# Deployment stage (dev, staging, prod)
STAGE=dev

# --------------------------------------------
# Optional: AWS Services (if using)
# --------------------------------------------

# S3 bucket for file uploads
# S3_BUCKET=valine-uploads-dev

# Cognito configuration for authentication
# COGNITO_POOL_ID=us-west-2_XXXXXXXXX
# COGNITO_REGION=us-west-2
# COGNITO_CLIENT_ID=XXXXXXXXXXXXXXXXXXXXXXXXXXXX

# --------------------------------------------
# Notes
# --------------------------------------------
# - The .env file is gitignored for security
# - Never commit sensitive credentials to version control
# - For production, use AWS Systems Manager Parameter Store or Secrets Manager
# - Frontend variables must be prefixed with VITE_ to be exposed to the client
