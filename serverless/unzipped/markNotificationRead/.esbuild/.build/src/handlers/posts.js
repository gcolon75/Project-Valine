var _=Object.create;var a=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var C=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var A=(r,e)=>()=>(r&&(e=r(r=0)),e);var b=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),E=(r,e)=>{for(var t in e)a(r,t,{get:e[t],enumerable:!0})},p=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of x(e))!N.call(r,n)&&n!==t&&a(r,n,{get:()=>e[n],enumerable:!(o=w(e,n))||o.enumerable});return r};var S=(r,e,t)=>(t=r!=null?_(C(r)):{},p(e||!r||!r.__esModule?a(t,"default",{value:r,enumerable:!0}):t,r)),d=r=>p(a({},"__esModule",{value:!0}),r);var L={};function M(r){return typeof r=="function"?r:e=>e.$extends(r)}function F(r){return r}var u,T,D,j,q,I,R,m,V,k,U,H,g,J,f=A(()=>{"use strict";u=Object.defineProperty,T=Object.getOwnPropertyDescriptor,D=Object.getOwnPropertyNames,j=Object.prototype.hasOwnProperty,q=(r,e)=>{for(var t in e)u(r,t,{get:e[t],enumerable:!0})},I=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of D(e))!j.call(r,n)&&n!==t&&u(r,n,{get:()=>e[n],enumerable:!(o=T(e,n))||o.enumerable});return r},R=r=>I(u({},"__esModule",{value:!0}),r),m={};q(m,{Prisma:()=>g,PrismaClient:()=>H,default:()=>J});module.exports=R(m);V={enginesVersion:"2ba551f319ab1df4bc874a89965d8b3641056773"},k="6.19.0",U=k,H=class{constructor(){throw new Error('@prisma/client did not initialize yet. Please run "prisma generate" and try to import it again.')}};g={defineExtension:M,getExtensionContext:F,prismaVersion:{client:U,engine:V.enginesVersion}},J={Prisma:g}});var h=b((ee,y)=>{y.exports={...(f(),d(L))}});var W={};E(W,{createPost:()=>$,getPost:()=>Q,listPosts:()=>K});module.exports=d(W);var P=S(h(),1),l;function c(){return l||(l=new P.PrismaClient),l}var z=process.env.FRONTEND_URL||"http://localhost:5173",B=process.env.NODE_ENV||"development",O=B==="production",G=()=>{let r=[z];return O&&r.push("https://dkmxy676d3vgc.cloudfront.net"),O||r.push("http://localhost:3000","http://localhost:5173"),r},X=r=>{let e=G(),t=r?.headers?.origin||r?.headers?.Origin||"";return{"Access-Control-Allow-Origin":e.includes(t)?t:e[0],"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,PATCH,OPTIONS","Access-Control-Allow-Headers":"Content-Type,Authorization,X-CSRF-Token","Access-Control-Max-Age":"86400"}};function i(r,e=200,t={}){let o=X(t.event);return delete t.event,{statusCode:e,headers:{"content-type":"application/json",...o,"x-content-type-options":"nosniff","referrer-policy":"strict-origin-when-cross-origin","permissions-policy":"camera=(), microphone=(), geolocation=()","strict-transport-security":"max-age=63072000; includeSubDomains; preload",...t},body:JSON.stringify(r)}}function s(r,e=400,t={}){return i({error:r},e,t)}var $=async r=>{try{let{content:e,media:t,authorId:o}=JSON.parse(r.body||"{}");if(!e||!o)return s("content and authorId are required",400);let v=await c().post.create({data:{content:e,media:t||[],authorId:o},include:{author:{select:{id:!0,username:!0,displayName:!0,avatar:!0}}}});return i(v,201)}catch(e){return console.error(e),s("Server error: "+e.message,500)}},K=async r=>{try{let{limit:e="20",cursor:t}=r.queryStringParameters||{},n=await c().post.findMany({take:parseInt(e),...t&&{cursor:{id:t},skip:1},orderBy:{createdAt:"desc"},include:{author:{select:{id:!0,username:!0,displayName:!0,avatar:!0}}}});return i(n)}catch(e){return console.error(e),s("Server error: "+e.message,500)}},Q=async r=>{try{let e=r.pathParameters?.id;if(!e)return s("id is required",400);let o=await c().post.findUnique({where:{id:e},include:{author:{select:{id:!0,username:!0,displayName:!0,avatar:!0}}}});return o?i(o):s("Post not found",404)}catch(e){return console.error(e),s("Server error: "+e.message,500)}};0&&(module.exports={createPost,getPost,listPosts});
