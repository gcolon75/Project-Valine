var b=Object.create;var a=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var E=(r,e)=>()=>(r&&(e=r(r=0)),e);var S=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),T=(r,e)=>{for(var t in e)a(r,t,{get:e[t],enumerable:!0})},m=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of C(e))!A.call(r,n)&&n!==t&&a(r,n,{get:()=>e[n],enumerable:!(o=x(e,n))||o.enumerable});return r};var D=(r,e,t)=>(t=r!=null?b(N(r)):{},m(e||!r||!r.__esModule?a(t,"default",{value:r,enumerable:!0}):t,r)),f=r=>m(a({},"__esModule",{value:!0}),r);var B={};function L(r){return typeof r=="function"?r:e=>e.$extends(r)}function M(r){return r}var l,U,j,q,R,V,k,g,H,J,F,I,y,z,O=E(()=>{"use strict";l=Object.defineProperty,U=Object.getOwnPropertyDescriptor,j=Object.getOwnPropertyNames,q=Object.prototype.hasOwnProperty,R=(r,e)=>{for(var t in e)l(r,t,{get:e[t],enumerable:!0})},V=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of j(e))!q.call(r,n)&&n!==t&&l(r,n,{get:()=>e[n],enumerable:!(o=U(e,n))||o.enumerable});return r},k=r=>V(l({},"__esModule",{value:!0}),r),g={};R(g,{Prisma:()=>y,PrismaClient:()=>I,default:()=>z});module.exports=k(g);H={enginesVersion:"2ba551f319ab1df4bc874a89965d8b3641056773"},J="6.19.0",F=J,I=class{constructor(){throw new Error('@prisma/client did not initialize yet. Please run "prisma generate" and try to import it again.')}};y={defineExtension:L,getExtensionContext:M,prismaVersion:{client:F,engine:H.enginesVersion}},z={Prisma:y}});var v=S((oe,h)=>{h.exports={...(O(),f(B))}});var Z={};T(Z,{createUser:()=>Q,getUser:()=>W,updateUser:()=>Y});module.exports=f(Z);var P=D(v(),1),u;function c(){return u||(u=new P.PrismaClient),u}var G=process.env.FRONTEND_URL||"http://localhost:5173",X=process.env.NODE_ENV||"development",_=X==="production",$=()=>{let r=[G];return _&&r.push("https://dkmxy676d3vgc.cloudfront.net"),_||r.push("http://localhost:3000","http://localhost:5173"),r},K=r=>{let e=$(),t=r?.headers?.origin||r?.headers?.Origin||"";return{"Access-Control-Allow-Origin":e.includes(t)?t:e[0],"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,PATCH,OPTIONS","Access-Control-Allow-Headers":"Content-Type,Authorization,X-CSRF-Token","Access-Control-Max-Age":"86400"}};function i(r,e=200,t={}){let o=K(t.event);return delete t.event,{statusCode:e,headers:{"content-type":"application/json",...o,"x-content-type-options":"nosniff","referrer-policy":"strict-origin-when-cross-origin","permissions-policy":"camera=(), microphone=(), geolocation=()","strict-transport-security":"max-age=63072000; includeSubDomains; preload",...t},body:JSON.stringify(r)}}function s(r,e=400,t={}){return i({error:r},e,t)}var Q=async r=>{try{let{username:e,email:t,displayName:o,bio:n,avatar:d,role:p}=JSON.parse(r.body||"{}");if(!e||!t||!o)return s("username, email, and displayName are required",400);let w=await c().user.create({data:{username:e,email:t,displayName:o,bio:n,avatar:d,role:p}});return i(w,201)}catch(e){return console.error(e),s("Server error: "+e.message,500)}},W=async r=>{try{let e=r.pathParameters?.username;if(!e)return s("username is required",400);let o=await c().user.findUnique({where:{username:e},include:{posts:{orderBy:{createdAt:"desc"},take:20},_count:{select:{posts:!0}}}});return o?i(o):s("User not found",404)}catch(e){return console.error(e),s("Server error: "+e.message,500)}},Y=async r=>{try{let e=r.pathParameters?.id,{displayName:t,bio:o,avatar:n}=JSON.parse(r.body||"{}");if(!e)return s("id is required",400);let p=await c().user.update({where:{id:e},data:{displayName:t,bio:o,avatar:n}});return i(p)}catch(e){return console.error(e),s("Server error: "+e.message,500)}};0&&(module.exports={createUser,getUser,updateUser});
