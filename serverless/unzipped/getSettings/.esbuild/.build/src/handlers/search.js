var b=Object.create;var u=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var q=(r,e)=>()=>(r&&(e=r(r=0)),e);var R=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),j=(r,e)=>{for(var t in e)u(r,t,{get:e[t],enumerable:!0})},y=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of E(e))!T.call(r,s)&&s!==t&&u(r,s,{get:()=>e[s],enumerable:!(n=D(e,s))||n.enumerable});return r};var k=(r,e,t)=>(t=r!=null?b(S(r)):{},y(e||!r||!r.__esModule?u(t,"default",{value:r,enumerable:!0}):t,r)),v=r=>y(u({},"__esModule",{value:!0}),r);var K={};function $(r){return typeof r=="function"?r:e=>e.$extends(r)}function G(r){return r}var f,I,M,U,V,H,F,O,L,z,B,J,P,X,_=q(()=>{"use strict";f=Object.defineProperty,I=Object.getOwnPropertyDescriptor,M=Object.getOwnPropertyNames,U=Object.prototype.hasOwnProperty,V=(r,e)=>{for(var t in e)f(r,t,{get:e[t],enumerable:!0})},H=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of M(e))!U.call(r,s)&&s!==t&&f(r,s,{get:()=>e[s],enumerable:!(n=I(e,s))||n.enumerable});return r},F=r=>H(f({},"__esModule",{value:!0}),r),O={};V(O,{Prisma:()=>P,PrismaClient:()=>J,default:()=>X});module.exports=F(O);L={enginesVersion:"2ba551f319ab1df4bc874a89965d8b3641056773"},z="6.19.0",B=z,J=class{constructor(){throw new Error('@prisma/client did not initialize yet. Please run "prisma generate" and try to import it again.')}};P={defineExtension:$,getExtensionContext:G,prismaVersion:{client:B,engine:L.enginesVersion}},X={Prisma:P}});var N=R((oe,A)=>{A.exports={...(_(),v(K))}});var te={};j(te,{searchProfiles:()=>ee,searchUsers:()=>re});module.exports=v(te);var w=k(N(),1),g;function h(){return g||(g=new w.PrismaClient),g}var Q=process.env.FRONTEND_URL||"http://localhost:5173",W=process.env.NODE_ENV||"development",x=W==="production",Y=()=>{let r=[Q];return x&&r.push("https://dkmxy676d3vgc.cloudfront.net"),x||r.push("http://localhost:3000","http://localhost:5173"),r},Z=r=>{let e=Y(),t=r?.headers?.origin||r?.headers?.Origin||"";return{"Access-Control-Allow-Origin":e.includes(t)?t:e[0],"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,PATCH,OPTIONS","Access-Control-Allow-Headers":"Content-Type,Authorization,X-CSRF-Token","Access-Control-Max-Age":"86400"}};function p(r,e=200,t={}){let n=Z(t.event);return delete t.event,{statusCode:e,headers:{"content-type":"application/json",...n,"x-content-type-options":"nosniff","referrer-policy":"strict-origin-when-cross-origin","permissions-policy":"camera=(), microphone=(), geolocation=()","strict-transport-security":"max-age=63072000; includeSubDomains; preload",...t},body:JSON.stringify(r)}}function l(r,e=400,t={}){return p({error:r},e,t)}var ee=async r=>{try{let{query:e,role:t,location:n,limit:s="20",cursor:i}=r.queryStringParameters||{};if(!e&&!t&&!n)return l("At least one search parameter (query, role, or location) is required",400);let a=h(),o={AND:[]};e&&(o.OR=[{vanityUrl:{contains:e,mode:"insensitive"}},{headline:{contains:e,mode:"insensitive"}},{bio:{contains:e,mode:"insensitive"}},{tags:{has:e}},{user:{OR:[{username:{contains:e,mode:"insensitive"}},{displayName:{contains:e,mode:"insensitive"}}]}}]),t&&o.AND.push({roles:{has:t}}),n&&o.AND.push({location:{path:["$"],string_contains:n}}),o.AND.push({privacy:{path:["visibility"],equals:"public"}}),o.AND.length===0&&delete o.AND;let c=await a.profile.findMany({where:o,take:parseInt(s)+1,...i&&{cursor:{id:i},skip:1},include:{user:{select:{id:!0,username:!0,displayName:!0,avatar:!0}},_count:{select:{media:!0,credits:!0}}},orderBy:{createdAt:"desc"}}),d=c.length>parseInt(s),m=d?c.slice(0,-1):c,C=d?m[m.length-1].id:null;return p({items:m,nextCursor:C,hasMore:d,query:{query:e,role:t,location:n}})}catch(e){return console.error("Search profiles error:",e),l("Server error: "+e.message,500)}},re=async r=>{try{let{query:e,limit:t="20",cursor:n}=r.queryStringParameters||{};if(!e)return l("query parameter is required",400);let i=await h().user.findMany({where:{OR:[{username:{contains:e,mode:"insensitive"}},{displayName:{contains:e,mode:"insensitive"}}]},take:parseInt(t)+1,...n&&{cursor:{id:n},skip:1},select:{id:!0,username:!0,displayName:!0,avatar:!0,bio:!0,role:!0,createdAt:!0},orderBy:{createdAt:"desc"}}),a=i.length>parseInt(t),o=a?i.slice(0,-1):i,c=a?o[o.length-1].id:null;return p({items:o,nextCursor:c,hasMore:a})}catch(e){return console.error("Search users error:",e),l("Server error: "+e.message,500)}};0&&(module.exports={searchProfiles,searchUsers});
