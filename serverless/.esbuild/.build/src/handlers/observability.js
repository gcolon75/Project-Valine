var D=Object.create;var m=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var R=(t,e)=>()=>(t&&(e=t(t=0)),e);var I=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),U=(t,e)=>{for(var r in e)m(t,r,{get:e[r],enumerable:!0})},O=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of j(e))!q.call(t,s)&&s!==r&&m(t,s,{get:()=>e[s],enumerable:!(n=k(e,s))||n.enumerable});return t};var V=(t,e,r)=>(r=t!=null?D(A(t)):{},O(e||!t||!t.__esModule?m(r,"default",{value:t,enumerable:!0}):r,t)),v=t=>O(m({},"__esModule",{value:!0}),t);var se={};function ee(t){return typeof t=="function"?t:e=>e.$extends(t)}function te(t){return t}var y,B,F,G,z,X,Y,b,K,Q,W,Z,w,re,_=R(()=>{"use strict";y=Object.defineProperty,B=Object.getOwnPropertyDescriptor,F=Object.getOwnPropertyNames,G=Object.prototype.hasOwnProperty,z=(t,e)=>{for(var r in e)y(t,r,{get:e[r],enumerable:!0})},X=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of F(e))!G.call(t,s)&&s!==r&&y(t,s,{get:()=>e[s],enumerable:!(n=B(e,s))||n.enumerable});return t},Y=t=>X(y({},"__esModule",{value:!0}),t),b={};z(b,{Prisma:()=>w,PrismaClient:()=>Z,default:()=>re});module.exports=Y(b);K={enginesVersion:"2ba551f319ab1df4bc874a89965d8b3641056773"},Q="6.19.0",W=Q,Z=class{constructor(){throw new Error('@prisma/client did not initialize yet. Please run "prisma generate" and try to import it again.')}};w={defineExtension:ee,getExtensionContext:te,prismaVersion:{client:W,engine:K.enginesVersion}},re={Prisma:w}});var P=I((de,S)=>{S.exports={...(_(),v(se))}});var pe={};U(pe,{getMetrics:()=>ae,getStats:()=>ie,healthCheck:()=>ce,ingestMetrics:()=>ne,logEvent:()=>le});module.exports=v(pe);var J=process.env.FRONTEND_URL||"http://localhost:5173",L=process.env.NODE_ENV||"development",M=L==="production",$=()=>{let t=[J];return M&&t.push("https://dkmxy676d3vgc.cloudfront.net"),M||t.push("http://localhost:3000","http://localhost:5173"),t},H=t=>{let e=$(),r=t?.headers?.origin||t?.headers?.Origin||"";return{"Access-Control-Allow-Origin":e.includes(r)?r:e[0],"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,PATCH,OPTIONS","Access-Control-Allow-Headers":"Content-Type,Authorization,X-CSRF-Token","Access-Control-Max-Age":"86400"}};function l(t,e=200,r={}){let n=H(r.event);return delete r.event,{statusCode:e,headers:{"content-type":"application/json",...n,"x-content-type-options":"nosniff","referrer-policy":"strict-origin-when-cross-origin","permissions-policy":"camera=(), microphone=(), geolocation=()","strict-transport-security":"max-age=63072000; includeSubDomains; preload",...r},body:JSON.stringify(t)}}function p(t,e=400,r={}){return l({error:t},e,r)}var C=V(P(),1),d;function g(){return d||(d=new C.PrismaClient),d}var o={requests:[],errors:[],performance:[],journeys:[]},h=1e3,oe=3600*1e3,f=()=>{let t=Date.now()-oe;Object.keys(o).forEach(e=>{o[e]=o[e].filter(r=>r.timestamp>t).slice(-h)})},ne=async t=>{try{let e=JSON.parse(t.body||"{}"),{type:r,data:n}=e;if(!r||!n)return p("type and data are required",400);let s={timestamp:Date.now(),type:r,data:n};switch(r){case"request":o.requests.push(s);break;case"error":o.errors.push(s);break;case"performance":o.performance.push(s);break;case"journey":o.journeys.push(s);break;default:o[r]||(o[r]=[]),o[r].push(s)}return Math.random()<.1&&f(),l({success:!0,message:"Metric ingested successfully",metric:{type:r,timestamp:s.timestamp}})}catch(e){return console.error("Metrics ingestion error:",e),p("Server error: "+e.message,500)}},ae=async t=>{try{let e=t.queryStringParameters||{},r=e.type,n=e.since?parseInt(e.since):Date.now()-900*1e3;f();let s=[];r?s=(o[r]||[]).filter(c=>c.timestamp>=n):Object.keys(o).forEach(c=>{let u=o[c].filter(i=>i.timestamp>=n);s.push(...u)});let a={total:s.length,byType:{},timeRange:{start:n,end:Date.now()}};return s.forEach(c=>{a.byType[c.type]||(a.byType[c.type]=0),a.byType[c.type]++}),l({metrics:s.slice(-100),aggregates:a})}catch(e){return console.error("Get metrics error:",e),p("Server error: "+e.message,500)}},ce=async t=>{let e={timestamp:new Date().toISOString(),status:"healthy",checks:{}};try{await g().$queryRaw`SELECT 1`,e.checks.database={status:"healthy",latency:0}}catch(s){e.checks.database={status:"unhealthy",error:s.message},e.status="degraded"}let r=process.memoryUsage();e.checks.memory={status:"healthy",heapUsed:`${Math.round(r.heapUsed/1024/1024)}MB`,heapTotal:`${Math.round(r.heapTotal/1024/1024)}MB`,rss:`${Math.round(r.rss/1024/1024)}MB`};let n=Object.values(o).reduce((s,a)=>s+a.length,0);return e.checks.metricsStore={status:n<h*5?"healthy":"degraded",totalMetrics:n,maxCapacity:h*5},e.environment={nodeVersion:process.version,platform:process.platform,arch:process.arch},l(e)},ie=async t=>{try{let e=g(),[r,n]=await Promise.all([e.user.count(),e.profile.count()]);f();let s=Date.now(),a=s-300*1e3,c=s-900*1e3,u=s-3600*1e3,i=(x,T)=>x.filter(N=>N.timestamp>=T).length,E={timestamp:new Date().toISOString(),database:{users:r,profiles:n},metrics:{requests:{last5Min:i(o.requests,a),last15Min:i(o.requests,c),last60Min:i(o.requests,u)},errors:{last5Min:i(o.errors,a),last15Min:i(o.errors,c),last60Min:i(o.errors,u)},performance:{last5Min:i(o.performance,a),last15Min:i(o.performance,c),last60Min:i(o.performance,u)}},system:{uptime:process.uptime(),memoryUsage:process.memoryUsage()}};return l(E)}catch(e){return console.error("Get stats error:",e),p("Server error: "+e.message,500)}},le=async t=>{try{let e=JSON.parse(t.body||"{}"),{level:r,message:n,context:s}=e;if(!r||!n)return p("level and message are required",400);let a={timestamp:new Date().toISOString(),level:r.toUpperCase(),message:n,context:s||{}};return console.log(JSON.stringify(a)),(r==="error"||r==="critical")&&o.errors.push({timestamp:Date.now(),type:"error",data:a}),l({success:!0,logged:a})}catch(e){return console.error("Log event error:",e),p("Server error: "+e.message,500)}};0&&(module.exports={getMetrics,getStats,healthCheck,ingestMetrics,logEvent});
